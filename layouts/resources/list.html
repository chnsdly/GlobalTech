{{ define "main" }}
<section class="blog-classic">
  <div class="container">
    <div class="layout layout--two"><!-- ä¿®å¤ï¼šåŠ  layout--two è§¦å‘å¸ƒå±€ -->

      <!-- ä¸»åˆ—ï¼šæ–‡ç« åˆ—è¡¨ï¼ˆres-list é£æ ¼ï¼‰ -->
      <div class="col-main">
        {{ $pgr := .Paginate (.RegularPagesRecursive.ByDate.Reverse) }}

        <ul class="res-list" role="list">
          {{ range $p := $pgr.Pages }}
            {{/* --------- è®¡ç®—å°é¢ --------- */}}
            {{ $cover := cond (isset $p.Params "cover_asset") $p.Params.cover_asset (cond (isset $p.Params "cover_image") $p.Params.cover_image (cond (isset $p.Params "cover") (index $p.Params "cover" "image") nil)) }}

            {{/* --------- è®¡ç®—ç±»å‹/å¾½ç«  --------- */}}
            {{ $kindRaw := or $p.Params.kind $p.Type }}
            {{ $kind := lower (printf "%v" $kindRaw) }}
            {{ $mapClass := dict "blog" "badge--blog" "articles" "badge--blog" "post" "badge--blog" "case" "badge--case" "cases" "badge--case" "whitepaper" "badge--whitepaper" "paper" "badge--whitepaper" "download" "badge--download" "dl" "badge--download" "video" "badge--video" "faq" "badge--faq" }}
            {{ $mapLabel := dict "blog" "Blog" "articles" "Blog" "post" "Blog" "case" "Case" "cases" "Case" "whitepaper" "WPaper" "paper" "WPaper" "download" "DL" "dl" "DL" "video" "Video" "faq" "FAQ" }}
            {{ $badgeClass := or (index $mapClass $kind) "badge--blog" }}
            {{ $badgeLabel := or (index $mapLabel $kind) "Blog" }}

            {{/* --------- CTA æ–‡æ¡ˆ --------- */}}
            {{ $cta := "é˜…è¯»" }}
            {{ if in (slice "case" "cases") $kind }}{{ $cta = "æŸ¥çœ‹æ¡ˆä¾‹" }}{{ end }}
            {{ if or (eq $kind "download") (eq $kind "dl") }}{{ $cta = "ä¸‹è½½" }}{{ end }}
            {{ if or (eq $kind "whitepaper") (eq $kind "paper") }}{{ $cta = "å…è´¹ä¸‹è½½" }}{{ end }}
            {{ if eq $kind "video" }}{{ $cta = "è§‚çœ‹" }}{{ end }}
            {{ if eq $kind "faq" }}{{ $cta = "æŸ¥çœ‹" }}{{ end }}

            <li class="res-row">
              <div class="res-thumb" aria-hidden="true">
                {{ with $cover }}
                  {{ partial "picture.html" (dict
                    "ctx"   $p
                    "src"   .
                    "alt"   $p.Title
                    "w"     (slice 256 512 768)
                    "sizes" "(max-width: 48rem) 100vw, 128px"
                    "class" "res-thumb__img"
                  ) }}
                {{ else }}
                  <img class="res-thumb__img" loading="lazy" alt=""
                       src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Crect width='100%25' height='100%25' fill='%23e5e7eb'/%3E%3C/svg%3E">
                {{ end }}
                <span class="badge {{ $badgeClass }}">{{ $badgeLabel }}</span>
                {{ if or $p.Params.gated $p.Params.locked }}<span class="badge badge--lock" title="ä¸‹è½½éœ€å¡«å†™ä¿¡æ¯">ğŸ”’</span>{{ end }}
              </div>

              <div class="res-main">
                <a class="res-title" href="{{ $p.RelPermalink }}">{{ $p.Title }}</a>

                <p class="res-desc">
                  {{- with $p.Params.description -}}
                    {{ . }}
                  {{- else -}}
                    {{- $txt := $p.Summary | plainify -}}
                    {{- if lt (len $txt) 10 }}{{ $txt = (truncate 200 ($p.Plain | plainify)) }}{{ end -}}
                    {{- $txt -}}
                  {{- end -}}
                </p>

                <div class="res-meta">
                  {{ with or $p.Params.subject $p.Params.topic }}
                    <span>ä¸»é¢˜ï¼š{{ . }}</span>
                  {{ end }}

                  {{ $showRead := not (or (eq $kind "download") (eq $kind "dl") (eq $kind "whitepaper") (eq $kind "paper")) }}
                  {{ if or $p.Params.reading (and $showRead (gt $p.ReadingTime 0)) }}
                    <span>é˜…è¯»ï¼š{{ or $p.Params.reading (printf "%d åˆ†é’Ÿ" $p.ReadingTime) }}</span>
                  {{ end }}

                  {{ with $p.Params.pages }}<span>é¡µæ•°ï¼š{{ . }}</span>{{ end }}

                  {{ $fileType := or $p.Params.file_type (cond (or (eq $kind "download") (eq $kind "whitepaper") (eq $kind "dl") (eq $kind "paper")) "PDF" nil) }}
                  {{ if or $fileType $p.Params.file_size }}
                    <span>æ–‡ä»¶ï¼š{{ if $fileType }}{{ $fileType }} Â· {{ end }}{{ with $p.Params.file_size }}{{ . }}{{ end }}</span>
                  {{ end }}

                  {{ with $p.Params.version }}<span>ç‰ˆæœ¬ï¼š{{ . }}</span>{{ end }}
                  {{ with $p.Params.industry }}<span>è¡Œä¸šï¼š{{ . }}</span>{{ end }}
                  {{ with $p.Params.result }}<span>ç»“æœï¼š{{ . }}</span>{{ end }}
                  {{ with $p.Params.langs }}<span>è¯­è¨€ï¼š{{ delimit . "/" }}</span>{{ end }}

                  <span>
                    {{ if eq $.Site.Language.Lang "zh" }}
                      æ›´æ–°ï¼š{{ ($p.Lastmod | time).Format "2006-01-02" }}
                    {{ else }}
                      Updated: {{ ($p.Lastmod | time).Format "Jan 2, 2006" }}
                    {{ end }}
                  </span>
                </div>
              </div>

              <div class="res-cta">
                <a class="button {{ if or (eq $kind "download") (eq $kind "dl") (eq $kind "whitepaper") (eq $kind "paper") }}button--primary{{ end }}"
                   href="{{ $p.RelPermalink }}">{{ $cta }}</a>
              </div>
            </li>
          {{ end }}
        </ul>

        {{ if gt $pgr.TotalPages 1 }}
          <nav class="res-pager" aria-label="åˆ†é¡µå¯¼èˆª">
            {{ if $pgr.HasPrev }}
              <a class="pager__btn" href="{{ $pgr.Prev.URL }}">ä¸Šä¸€é¡µ</a>
            {{ else }}
              <a class="pager__btn is-disabled" aria-disabled="true" href="javascript:void(0)">ä¸Šä¸€é¡µ</a>
            {{ end }}

            {{ range $pg := $pgr.Pagers }}
              <a class="pager__num {{ if eq $pg.PageNumber $pgr.PageNumber }}is-active{{ end }}" href="{{ $pg.URL }}">{{ $pg.PageNumber }}</a>
            {{ end }}

            {{ if $pgr.HasNext }}
              <a class="pager__btn" href="{{ $pgr.Next.URL }}">ä¸‹ä¸€é¡µ</a>
            {{ else }}
              <a class="pager__btn is-disabled" aria-disabled="true" href="javascript:void(0)">ä¸‹ä¸€é¡µ</a>
            {{ end }}
          </nav>
        {{ end }}
      </div>

      <!-- ä¾§è¾¹æ ï¼šä¿æŒåŸæœ‰ç»“æ„ä¸ç±»å -->
      <aside class="col-side is-flat">
        {{/* çƒ­é—¨æ–‡ç« ï¼šä¼˜å…ˆæ‰‹åŠ¨ popular:trueï¼Œå¦åˆ™å›é€€æœ€æ–° */}}
        {{ $limit := or .Site.Params.blog.popular.limit 4 }}
        {{ $all := .CurrentSection.RegularPagesRecursive }}
        {{ $pp := where $all "Params.popular" true }}
        {{ if gt (len $pp) 0 }}{{ $pp = first $limit ($pp.ByDate.Reverse) }}{{ else }}{{ $pp = first $limit ($all.ByDate.Reverse) }}{{ end }}
        {{ if gt (len $pp) 0 }}
          <section class="widget widget-popular">
            <p class="widget-title">{{ if eq $.Site.Language.Lang "zh" }}çƒ­é—¨æ–‡ç« {{ else }}Popular{{ end }}</p>
            <ul class="popular-list">
              {{ range $it := $pp }}
                <li class="popular-item">
                  <a class="popular-link" href="{{ $it.RelPermalink }}">
                    <span class="ph ph--sm">
                      {{ with $it.Params.cover_asset }}
                        {{ partial "picture.html" (dict
                          "ctx"   $it
                          "src"   .
                          "alt"   $it.Title
                          "w"     (slice 84 168 252)
                          "sizes" "84px"
                          "class" "ph__img"
                        ) }}
                      {{ else }}
                        <span class="ph ph--empty" aria-hidden="true"></span>
                      {{ end }}
                    </span>
                    <span class="s">
                      <span class="s2 clamp2">{{ $it.Title }}</span>
                      <span class="s clamp1">
                        {{ with $it.Params.description }}{{ . }}{{ else }}{{ $it.Summary | plainify }}{{ end }}
                      </span>
                    </span>
                  </a>
                </li>
              {{ end }}
            </ul>
          </section>
        {{ end }}

        {{/* æ ç›®ï¼ˆSectionsï¼‰ */}}
        {{ $root := $.Site.GetPage "section" .Section }}
        {{ if and $root (gt (len $root.Sections) 0) }}
          <section class="widget widget-sections">
            <p class="widget-title">{{ if eq $.Site.Language.Lang "zh" }}æ ç›®{{ else }}Sections{{ end }}</p>
            <ul class="section-list">
              <li class="section-item">
                <a class="chip {{ if eq $.RelPermalink $root.RelPermalink }}is-active{{ end }}" href="{{ $root.RelPermalink }}">
                  {{ if eq $.Site.Language.Lang "zh" }}å…¨éƒ¨{{ else }}All{{ end }}
                  <span class="count">{{ len $root.RegularPagesRecursive }}</span>
                </a>
              </li>
              {{ range $sec := $root.Sections }}
                <li class="section-item">
                  <a class="chip {{ if eq $.RelPermalink $sec.RelPermalink }}is-active{{ end }}" href="{{ $sec.RelPermalink }}">
                    {{ $sec.Title }} <span class="count">{{ len $sec.RegularPagesRecursive }}</span>
                  </a>
                </li>
              {{ end }}
            </ul>
          </section>
        {{ end }}

        {{/* æ ‡ç­¾äº‘ */}}
        {{ with site.Taxonomies.tags }}
          <section class="widget widget-tags">
            <p class="widget-title">Tags</p>
            <div class="tag-cloud">
              {{ range first 20 (sort . "Count" "desc") }}
                <a class="chip" href="{{ .Page.RelPermalink }}">#{{ .Page.Title }}</a>
              {{ end }}
            </div>
          </section>
        {{ end }}
      </aside>

    </div>
  </div>
</section>
{{ end }}
