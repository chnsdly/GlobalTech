{{ $navParams := .Site.Params.navigation }}
{{ $variantOptions := slice "aurora" "meridian" "voyager" "zenith" }}
{{ $variantAliases := dict
  "aurora" "aurora"
  "aurora-theme" "aurora"
  "variant1" "aurora"
  "version1" "aurora"
  "nav1" "aurora"
  "v1" "aurora"
  "1" "aurora"
  "版本1" "aurora"
  "方案1" "aurora"
  "meridian" "meridian"
  "meridian-theme" "meridian"
  "variant2" "meridian"
  "version2" "meridian"
  "nav2" "meridian"
  "v2" "meridian"
  "2" "meridian"
  "版本2" "meridian"
  "方案2" "meridian"
  "voyager" "voyager"
  "voyager-theme" "voyager"
  "variant3" "voyager"
  "version3" "voyager"
  "nav3" "voyager"
  "v3" "voyager"
  "3" "voyager"
  "版本3" "voyager"
  "方案3" "voyager"
  "zenith" "zenith"
  "zenith-theme" "zenith"
  "variant4" "zenith"
  "version4" "zenith"
  "nav4" "zenith"
  "v4" "zenith"
  "4" "zenith"
  "版本4" "zenith"
  "方案4" "zenith"
}}
{{ $variantIndexMap := dict "aurora" "variant1" "meridian" "variant2" "voyager" "variant3" "zenith" "variant4" }}
{{ $requestedVariant := "" }}
{{ with $navParams }}
  {{ with .variant }}
    {{ $requestedVariant = printf "%v" . }}
    {{ $requestedVariant = lower (strings.TrimSpace $requestedVariant) }}
  {{ end }}
{{ end }}
{{ $variant := "voyager" }}
{{ if $requestedVariant }}
  {{ with (index $variantAliases $requestedVariant) }}
    {{ $variant = . }}
  {{ else if in $variantOptions $requestedVariant }}
    {{ $variant = $requestedVariant }}
  {{ end }}
{{ end }}
{{ $variantPreset := "" }}
{{ with (index $variantIndexMap $variant) }}
  {{ $variantPreset = . }}
{{ end }}
{{ $menuTitle := i18n "menu" | default "Menu" }}

{{ $ctaLabel := "" }}
{{ $ctaUrl := "" }}
{{ $ctaEnabled := false }}
{{ $ctaNewTab := false }}
{{ $ctaRelParts := slice }}
{{ with $navParams }}
  {{ with .cta }}
    {{ $ctaLabel = default "" .label }}
    {{ $ctaUrl = default "" .url }}
    {{ $ctaNewTab = default false .newTab }}
    {{ if and (ne $ctaLabel "") (ne $ctaUrl "") }}
      {{ $ctaEnabled = true }}
      {{ if $ctaNewTab }}
        {{ $ctaRelParts = append $ctaRelParts "noopener" "noreferrer" }}
      {{ end }}
      {{ with .rel }}
        {{ $ctaRelParts = append $ctaRelParts . }}
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}
{{ $ctaTarget := "" }}
{{ if $ctaNewTab }}
  {{ $ctaTarget = "_blank" }}
{{ end }}
{{ $ctaRel := "" }}
{{ if gt (len $ctaRelParts) 0 }}
  {{ $ctaRel = delimit $ctaRelParts " " }}
{{ end }}

{{ $searchEnabled := false }}
{{ $searchAction := "/search/" }}
{{ $searchPlaceholder := i18n "search" | default "Search" }}
{{ $searchParam := "q" }}
{{ with $navParams }}
  {{ with .search }}
    {{ $searchEnabled = default false .enable }}
    {{ with .action }}
      {{ $searchAction = . }}
    {{ end }}
    {{ with .placeholder }}
      {{ $searchPlaceholder = . }}
    {{ end }}
    {{ with .param }}
      {{ $searchParam = . }}
    {{ end }}
  {{ end }}
{{ end }}
{{ $searchAction = relLangURL $searchAction }}

<header class="site-header site-header--{{ $variant }}{{ if $variantPreset }} site-header--{{ $variantPreset }}{{ end }}" id="site-header" data-nav-variant="{{ $variant }}"{{ if $variantPreset }} data-nav-preset="{{ $variantPreset }}"{{ end }}>
  <div class="navbar container">
    <div class="navbar__logo">
      <a href="{{ "/" | relLangURL }}" class="navbar__brand" aria-label="{{ .Site.Params.company_name | default .Site.Title }} home">
        <img src='{{ (.Site.Params.logo | default "images/logo.jpg") | relURL }}' width="72" height="72" alt='{{ .Site.Params.company_name | default .Site.Title }}'>
      </a>
    </div>

    <nav class="navbar__menu" aria-label="Main navigation">
      {{ $current := . }}
      <ul>
        {{ range .Site.Menus.main }}
        {{ $active := or ($current.IsMenuCurrent "main" .) ($current.HasMenuCurrent "main" .) }}
        {{ $isProducts := eq .Identifier "products" }}
        <li class="navbar__menu-item {{ if .HasChildren }}has-dropdown{{ end }}{{ if $isProducts }} has-mega{{ end }}">
          <a href="{{ .URL | relLangURL }}" class="navbar__menu-link {{ if $active }}is-active{{ end }}"{{ if $active }} aria-current="page"{{ end }}>
            <span>{{ .Name }}</span>
            {{ if .HasChildren }}
            <svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.17l3.71-3.94a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
            </svg>
            {{ end }}
          </a>

          {{ if .HasChildren }}
          {{ if $isProducts }}
          <div class="mega-menu" aria-label="Products submenu">
            <div class="mega-menu__inner container container--wide">
              <div class="mega-menu__grid">
                {{ range .Children }}
                {{ $group := . }}
                {{ $groupActive := or ($current.IsMenuCurrent "main" $group) ($current.HasMenuCurrent "main" $group) }}
                <div class="mega-menu__group">
                  {{ $groupHasUrl := $group.URL }}
                  <div class="mega-menu__title-wrapper">
                    {{ if $groupHasUrl }}
                    <a href="{{ $group.URL | relLangURL }}" class="mega-menu__title {{ if $groupActive }}is-active{{ end }}"{{ if $groupActive }} aria-current="page"{{ end }}>{{ $group.Name }}</a>
                    {{ else }}
                    <span class="mega-menu__title">{{ $group.Name }}</span>
                    {{ end }}
                  </div>
                  {{ if $group.HasChildren }}
                  {{ $isStyleGroup := eq $group.Identifier "products-style" }}
                  <ul class="mega-menu__list{{ if $isStyleGroup }} mega-menu__list--single{{ end }}">
                    {{ range $group.Children }}
                    {{ $itemActive := or ($current.IsMenuCurrent "main" .) ($current.HasMenuCurrent "main" .) }}
                    <li>
                      <a href="{{ .URL | relLangURL }}" class="{{ if $itemActive }}is-active{{ end }}"{{ if $itemActive }} aria-current="page"{{ end }}>{{ .Name }}</a>
                    </li>
                    {{ end }}
                  </ul>
                  {{ end }}
                </div>
                {{ end }}
              </div>
            </div>
          </div>
          {{ else }}
          <ul class="dropdown-menu">
            {{ range .Children }}
            {{ $childActive := or ($current.IsMenuCurrent "main" .) ($current.HasMenuCurrent "main" .) }}
            <li>
              <a href="{{ .URL | relLangURL }}" class="{{ if $childActive }}is-active{{ end }}"{{ if $childActive }} aria-current="page"{{ end }}>{{ .Name }}</a>
            </li>
            {{ end }}
          </ul>
          {{ end }}
          {{ end }}
        </li>
        {{ end }}
      </ul>
    </nav>

    <div class="navbar__actions">
      {{ if and $searchEnabled (gt (len $searchParam) 0) }}
      <form class="navbar__search" role="search" method="get" action="{{ $searchAction }}">
        <label class="sr-only" for="navbar-search">{{ i18n "search" | default "Search" }}</label>
        <input id="navbar-search" name="{{ $searchParam }}" type="search" placeholder="{{ $searchPlaceholder }}" autocomplete="search" />
        <button type="submit" aria-label="{{ i18n "search" | default "Search" }}">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.6" aria-hidden="true">
            <circle cx="9" cy="9" r="6"></circle>
            <path d="m13.5 13.5 4 4"></path>
          </svg>
        </button>
      </form>
      {{ end }}

      {{ if $ctaEnabled }}
      <a class="navbar__cta" href="{{ $ctaUrl | relLangURL }}"{{ if $ctaTarget }} target="{{ $ctaTarget }}"{{ end }}{{ if $ctaRel }} rel="{{ $ctaRel }}"{{ end }}>
        {{ $ctaLabel }}
      </a>
      {{ end }}

      {{ if hugo.IsMultilingual }}
      <div class="lang-switcher">
        <button class="lang-switcher__button" type="button" aria-haspopup="true" aria-expanded="false">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke="currentColor" aria-hidden="true" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M2 12h20"></path>
            <path d="M12 2a15.75 15.75 0 0 1 0 20"></path>
            <path d="M12 2a15.75 15.75 0 0 0 0 20"></path>
          </svg>
          <span>{{ .Site.Language.LanguageName }}</span>
        </button>
        <div class="lang-switcher__dropdown" role="menu">
          {{ range .Site.Home.AllTranslations }}
          {{ if ne .Language.Lang $.Site.Language.Lang }}
          <a href="{{ .RelPermalink }}" role="menuitem">{{ .Language.LanguageName }}</a>
          {{ end }}
          {{ end }}
        </div>
      </div>
      {{ end }}

      <button class="navbar__toggler" id="drawer-toggler" aria-label="Open menu" aria-expanded="false">
        <span class="toggler-bar"></span>
        <span class="toggler-bar"></span>
        <span class="toggler-bar"></span>
      </button>
    </div>
  </div>
</header>

<div class="drawer-overlay" id="drawer-overlay"></div>
<aside class="drawer drawer--{{ $variant }}{{ if $variantPreset }} drawer--{{ $variantPreset }}{{ end }}" id="drawer" aria-hidden="true"{{ if $variantPreset }} data-nav-preset="{{ $variantPreset }}"{{ end }}>
  <div class="drawer__header">
    <button class="drawer__back" id="drawer-back" type="button" aria-label="{{ i18n "backToMenu" | default "Back to main menu" }}" hidden>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M12.78 4.22a.75.75 0 010 1.06L8.56 9.5H16a.75.75 0 010 1.5H8.56l4.22 4.22a.75.75 0 11-1.06 1.06l-5.5-5.5a.75.75 0 010-1.06l5.5-5.5a.75.75 0 011.06 0z" clip-rule="evenodd" />
      </svg>
    </button>
    <span class="drawer__title" id="drawer-title" data-default="{{ $menuTitle }}">{{ $menuTitle }}</span>
  </div>

  <nav class="drawer__menu" aria-label="Mobile navigation">
    {{ $current := . }}
    <div class="drawer__panel is-active" id="panel-root" data-panel="root" data-title="{{ $menuTitle }}" aria-hidden="false">
      <ul class="drawer__list">
        {{ range .Site.Menus.main }}
        {{ $active := or ($current.IsMenuCurrent "main" .) ($current.HasMenuCurrent "main" .) }}
        {{ $panelKey := default .Name .Identifier }}
        {{ $panelSlug := lower (replaceRE "[^a-zA-Z0-9]+" "-" $panelKey) }}
        {{ $panelID := printf "panel-%s" $panelSlug }}
        <li class="drawer__item drawer__item--root{{ if .HasChildren }} has-children{{ end }}">
          <a href="{{ .URL | relLangURL }}" class="drawer__link {{ if $active }}is-active{{ end }}"{{ if $active }} aria-current="page"{{ end }}>
            <span>{{ .Name }}</span>
          </a>
          {{ if .HasChildren }}
          <button class="drawer__arrow" type="button" data-target="{{ $panelID }}" aria-controls="{{ $panelID }}" aria-haspopup="true" aria-expanded="false" aria-label="{{ printf "View submenu for %s" .Name }}">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" d="M7.22 4.22a.75.75 0 011.06 0l5.5 5.5a.75.75 0 010 1.06l-5.5 5.5a.75.75 0 11-1.06-1.06L11.94 10 7.22 5.28a.75.75 0 010-1.06z" clip-rule="evenodd" />
            </svg>
          </button>
          {{ end }}
        </li>
        {{ end }}
      </ul>

      {{ if hugo.IsMultilingual }}
      <div class="drawer__languages" data-languages>
        <button class="drawer__languages-toggle" type="button" aria-expanded="false" data-languages-toggle aria-controls="drawer-languages-panel">
          <span>{{ i18n "language" | default "Language" }}</span>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.17l3.71-3.94a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
          </svg>
        </button>
        <div class="drawer__languages-panel" id="drawer-languages-panel" data-languages-panel hidden>
          <ul class="drawer__languages-list">
            {{ range .Site.Home.AllTranslations }}
            {{ if ne .Language.Lang $.Site.Language.Lang }}
            <li>
              <a class="drawer__link" href="{{ .RelPermalink }}">{{ .Language.LanguageName }}</a>
            </li>
            {{ end }}
            {{ end }}
          </ul>
        </div>
      </div>
      {{ end }}
    </div>

    {{ range .Site.Menus.main }}
    {{ if .HasChildren }}
    {{ $panelKey := default .Name .Identifier }}
    {{ $panelSlug := lower (replaceRE "[^a-zA-Z0-9]+" "-" $panelKey) }}
    {{ $panelID := printf "panel-%s" $panelSlug }}
    <div class="drawer__panel{{ if eq .Identifier "products" }} drawer__panel--products{{ end }}" id="{{ $panelID }}" data-panel="{{ $panelID }}" data-title="{{ .Name }}" aria-hidden="true" hidden>
      <button class="drawer__panel-back" type="button" data-panel-back aria-label="{{ i18n "backToMenu" | default "Back to main menu" }}">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path fill-rule="evenodd" d="M12.78 4.22a.75.75 0 010 1.06L8.56 9.5H16a.75.75 0 010 1.5H8.56l4.22 4.22a.75.75 0 11-1.06 1.06l-5.5-5.5a.75.75 0 010-1.06l5.5-5.5a.75.75 0 011.06 0z" clip-rule="evenodd" />
        </svg>
        <span class="sr-only">{{ $menuTitle }}</span>
      </button>
      <ul class="drawer__list">
        {{ range .Children }}
        {{ $childActive := or ($current.IsMenuCurrent "main" .) ($current.HasMenuCurrent "main" .) }}
        <li class="drawer__item drawer__item--second{{ if .HasChildren }} has-children{{ end }}">
          <a href="{{ .URL | relLangURL }}" class="drawer__link {{ if $childActive }}is-active{{ end }}"{{ if $childActive }} aria-current="page"{{ end }}>
            <span>{{ .Name }}</span>
          </a>
          {{ if .HasChildren }}
          <ul class="drawer__sublist">
            {{ range .Children }}
            {{ $grandActive := or ($current.IsMenuCurrent "main" .) ($current.HasMenuCurrent "main" .) }}
            <li>
              <a href="{{ .URL | relLangURL }}" class="drawer__sublink {{ if $grandActive }}is-active{{ end }}"{{ if $grandActive }} aria-current="page"{{ end }}>{{ .Name }}</a>
            </li>
            {{ end }}
          </ul>
          {{ end }}
        </li>
        {{ end }}
      </ul>
    </div>
    {{ end }}
    {{ end }}
  </nav>
</aside>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const header = document.getElementById('site-header');
    const navVariant = header ? header.dataset.navVariant : '';
    if (navVariant) {
      document.documentElement.setAttribute('data-nav-variant', navVariant);
    }
    const navPreset = header ? header.dataset.navPreset : '';
    if (navPreset) {
      document.documentElement.setAttribute('data-nav-preset', navPreset);
    }

    const body = document.body;
    const bodyHiddenClass = 'header-hidden';

    if (header) {
      let lastScrollY = window.scrollY;
      const scrollThreshold = Math.max(10, header.offsetHeight);
      const scrollDelta = 5;

      function handleSmartHeader() {
        const currentScrollY = window.scrollY;

        if (currentScrollY > 10) header.classList.add('is-scrolled');
        else header.classList.remove('is-scrolled');

        if (currentScrollY <= scrollThreshold) {
          header.classList.remove('is-hidden');
          body.classList.remove(bodyHiddenClass);
          lastScrollY = currentScrollY;
          return;
        }

        if (Math.abs(lastScrollY - currentScrollY) < scrollDelta) {
          return;
        }

        if (currentScrollY < lastScrollY) {
          header.classList.remove('is-hidden');
          body.classList.remove(bodyHiddenClass);
        } else if (currentScrollY > lastScrollY) {
          header.classList.add('is-hidden');
          body.classList.add(bodyHiddenClass);
        }

        lastScrollY = currentScrollY;
      }

      let ticking = false;
      window.addEventListener('scroll', () => {
        if (!ticking) {
          window.requestAnimationFrame(() => {
            handleSmartHeader();
            ticking = false;
          });
          ticking = true;
        }
      });

      handleSmartHeader();
    }

    const drawer = document.getElementById('drawer');
    const drawerToggler = document.getElementById('drawer-toggler');
    const drawerOverlay = document.getElementById('drawer-overlay');
    const drawerBack = document.getElementById('drawer-back');
    const drawerTitle = document.getElementById('drawer-title');
    const drawerPanels = drawer ? Array.from(drawer.querySelectorAll('[data-panel]')) : [];
    const rootPanel = drawer ? drawer.querySelector('[data-panel="root"]') : null;
    const languageContainer = drawer ? drawer.querySelector('[data-languages]') : null;
    const languageToggle = drawer ? drawer.querySelector('[data-languages-toggle]') : null;
    const languagePanel = drawer ? drawer.querySelector('[data-languages-panel]') : null;
    let activePanel = rootPanel;
    const focusableSelector = 'a[href]:not([tabindex="-1"]), button:not([disabled]):not([tabindex="-1"]), [tabindex]:not([tabindex="-1"])';

    const isElementVisible = (element) => {
      if (!element) return false;
      return element.offsetWidth > 0 || element.offsetHeight > 0 || element.getClientRects().length > 0;
    };

    const focusFirstElement = (container) => {
      if (!container) return;
      const focusable = Array.from(container.querySelectorAll(focusableSelector)).filter(isElementVisible);
      if (focusable.length) {
        requestAnimationFrame(() => {
          focusable[0].focus({ preventScroll: true });
        });
      }
    };

    const resetSubmenuTriggers = () => {
      if (!drawer) return;
      const triggers = drawer.querySelectorAll('.drawer__arrow[data-target]');
      triggers.forEach((trigger) => {
        trigger.setAttribute('aria-expanded', 'false');
      });
    };

    const collapseLanguages = () => {
      if (!languageContainer || !languageToggle || !languagePanel) return;
      languageContainer.classList.remove('is-open');
      languageToggle.setAttribute('aria-expanded', 'false');
      languagePanel.hidden = true;
    };

    const showPanel = (panelId, { shouldFocus = true } = {}) => {
      if (!drawer) return;
      const target = typeof panelId === 'string'
        ? drawer.querySelector(`[data-panel="${panelId}"]`)
        : panelId;
      if (!target) return;

      drawerPanels.forEach((panel) => {
        const isTarget = panel === target;
        panel.classList.toggle('is-active', isTarget);
        panel.toggleAttribute('hidden', !isTarget);
        panel.setAttribute('aria-hidden', isTarget ? 'false' : 'true');
      });

      activePanel = target;
      const isRoot = activePanel === rootPanel;
      drawer.classList.toggle('drawer--submenu', !isRoot);

      if (drawerBack) {
        drawerBack.hidden = isRoot;
      }

      if (drawerTitle) {
        const defaultTitle = drawerTitle.dataset.default || drawerTitle.textContent || '';
        const panelTitle = activePanel.dataset.title || defaultTitle;
        drawerTitle.textContent = panelTitle;
      }

      if (!isRoot) {
        collapseLanguages();
      }

      if (shouldFocus) {
        focusFirstElement(activePanel);
      }
    };

    const resetDrawerState = () => {
      collapseLanguages();
      if (rootPanel) {
        showPanel('root', { shouldFocus: false });
      }
      resetSubmenuTriggers();
    };

    const setTogglerState = (isOpen) => {
      if (!drawerToggler) return;
      drawerToggler.classList.toggle('open', isOpen);
      drawerToggler.setAttribute('aria-expanded', String(isOpen));
      drawerToggler.setAttribute('aria-label', isOpen ? 'Close menu' : 'Open menu');
    };

    const openDrawer = () => {
      body.setAttribute('data-drawer-open', 'true');
      if (drawer) {
        drawer.setAttribute('aria-hidden', 'false');
        resetDrawerState();
      }
      setTogglerState(true);
      if (rootPanel) {
        focusFirstElement(rootPanel);
      }
    };

    const closeDrawer = () => {
      body.setAttribute('data-drawer-open', 'false');
      if (drawer) {
        drawer.setAttribute('aria-hidden', 'true');
        resetDrawerState();
      }
      setTogglerState(false);
      if (drawerToggler) {
        drawerToggler.focus({ preventScroll: true });
      }
    };

    if (drawerToggler) {
      drawerToggler.setAttribute('aria-expanded', 'false');
      drawerToggler.addEventListener('click', () => {
        const isOpen = body.getAttribute('data-drawer-open') === 'true';
        if (isOpen) {
          closeDrawer();
        } else {
          openDrawer();
        }
      });
    }

    if (drawerOverlay) {
      drawerOverlay.addEventListener('click', closeDrawer);
    }

    if (drawerBack) {
      drawerBack.addEventListener('click', () => {
        showPanel('root');
        resetSubmenuTriggers();
      });
    }

    if (drawer && drawerPanels.length) {
      const submenuTriggers = drawer.querySelectorAll('.drawer__arrow[data-target]');
      submenuTriggers.forEach((button) => {
        button.addEventListener('click', () => {
          const panelId = button.getAttribute('data-target');
          if (panelId) {
            resetSubmenuTriggers();
            button.setAttribute('aria-expanded', 'true');
            showPanel(panelId);
          }
        });
      });

      const panelBackButtons = drawer.querySelectorAll('[data-panel-back]');
      panelBackButtons.forEach((button) => {
        button.addEventListener('click', () => {
          showPanel('root');
          resetSubmenuTriggers();
        });
      });
    }

    if (languageToggle && languagePanel && languageContainer) {
      languagePanel.hidden = true;
      languageToggle.addEventListener('click', () => {
        const isExpanded = languageToggle.getAttribute('aria-expanded') === 'true';
        const nextState = !isExpanded;
        languageToggle.setAttribute('aria-expanded', String(nextState));
        languageContainer.classList.toggle('is-open', nextState);
        languagePanel.hidden = !nextState;
      });
    }

    document.addEventListener('keydown', (event) => {
      const isDrawerOpen = body.getAttribute('data-drawer-open') === 'true';
      if (!isDrawerOpen) {
        return;
      }

      if (event.key === 'Escape') {
        closeDrawer();
        return;
      }

      if (event.key === 'Tab' && drawer) {
        const focusable = Array.from(drawer.querySelectorAll(focusableSelector)).filter(isElementVisible);
        if (!focusable.length) return;

        const first = focusable[0];
        const last = focusable[focusable.length - 1];
        const active = document.activeElement;

        if (event.shiftKey) {
          if (active === first || !drawer.contains(active)) {
            event.preventDefault();
            last.focus();
          }
        } else if (active === last) {
          event.preventDefault();
          first.focus();
        }
      }
    });

    const langSwitcherButton = document.querySelector('.lang-switcher__button');
    const langSwitcherDropdown = document.querySelector('.lang-switcher__dropdown');
    if (langSwitcherButton && langSwitcherDropdown) {
      langSwitcherButton.addEventListener('click', () => {
        const expanded = langSwitcherButton.getAttribute('aria-expanded') === 'true';
        langSwitcherButton.setAttribute('aria-expanded', String(!expanded));
        langSwitcherDropdown.hidden = expanded;
      });

      langSwitcherDropdown.hidden = true;
      document.addEventListener('click', (event) => {
        if (!langSwitcherDropdown.contains(event.target) && !langSwitcherButton.contains(event.target)) {
          langSwitcherDropdown.hidden = true;
          langSwitcherButton.setAttribute('aria-expanded', 'false');
        }
      });
    }

    resetDrawerState();
  });
</script>
